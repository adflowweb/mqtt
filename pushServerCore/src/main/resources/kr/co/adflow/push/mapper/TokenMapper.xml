<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
     PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.adflow.push.mapper.TokenMapper">

	<select id="get" resultType="kr.co.adflow.push.domain.Token">
		SELECT tokenID, userID, issue 
		FROM token 
		WHERE tokenid =	#{token}
	</select>

	<select id="getLatest" parameterType="kr.co.adflow.push.domain.Token"
		resultType="kr.co.adflow.push.domain.Token">
		SELECT tokenID, userID, issue 
		FROM token 
		WHERE userid= #{userID} 
		order by issue desc 
		limit 1
	</select>

	<insert id="post" parameterType="kr.co.adflow.push.domain.Token">
		INSERT INTO (tokenID, userID, issue, lastAccessTime)
		token
		values(#{tokenID}, #{userID}, now(), now())
	</insert>
	
	<update id="put" parameterType="kr.co.adflow.push.domain.Token">
		UPDATE token
		SET userid = #{userid} ,
			issue = #{issue},
            lastAcessTime = #{lastAcessTime}
		WHERE tokenID = #{tokenID}
	</update>
	
		<update id="putLastAcessTime" parameterType="kr.co.adflow.push.domain.Token">
		UPDATE token
		SET lastAcessTime = now()
		WHERE tokenID = #{tokenID}
	</update>

	<select id="validate" resultType="boolean">
		SELECT CASE WHEN count(*) > 0
		THEN 1 ELSE 0 END From token where tokenid = #{token}
	</select>

	<delete id="delete" parameterType="java.lang.String">
		DELETE from
		token
		WHERE
		tokenid=#{token}
	</delete>
	
	<select id="getByUser" resultType="kr.co.adflow.push.domain.Token">
		SELECT * FROM token WHERE userid =
		#{userID}
	</select>
	
	<select id="getMultiByUser" resultType="kr.co.adflow.push.domain.Token">
		SELECT * FROM token WHERE userid like CONCAT(#{userID}, '%')
	</select>

</mapper>